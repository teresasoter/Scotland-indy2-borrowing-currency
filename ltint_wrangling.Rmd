---
title: "Long term interest rates - GDP - debt-to-GDP ratio"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library (tidyverse)
library (plotly)
```

## Data cleaning

Uploading data
```{r, message=FALSE, warning=FALSE}
total <- read_csv("data/LTINT_GDP.csv")
df_gdp <- read_csv("data/GDP_yearly.csv")
df_ltint <- read_csv("data/LTINT_yearly.csv")
```

Making data wide
I removed the Flag Codes to make the wide frames more manageable. Flags were not necessary for the analysis.
```{r}
df_ltint_wide <- df_ltint %>% 
  select(-`Flag Codes`) %>% 
  pivot_wider(names_from = INDICATOR, values_from = Value)
```

Using MEASURE variable as the pivot to make it wide (names_from = MEASURE) because there were two different measures of GDP (million USD and per capita)
Then dropping the INDICATOR variable that had GDP as values
```{r}
df_gdp_wide <- df_gdp %>% 
  select(-`Flag Codes`) %>% 
  pivot_wider(names_from = MEASURE, values_from = Value, names_prefix = "GDP_") %>% 
  select(-INDICATOR)
```

Merging GDP and long term interest rates in one dataframe
```{r}
df_merged <- df_gdp_wide %>% left_join(df_ltint_wide %>% select(LOCATION, TIME, LTINT), by = c("LOCATION","TIME"))
```


```{r}
df_debt_ratio <- read_csv("data/debt_gdp_ratio_oecd.csv")

```


```{r}
df_debt_ratio <- df_debt_ratio %>% rename(debt_gdp = Value)
```

```{r}
df_debt_wide <- df_debt_ratio %>% 
  select(-`Flag Codes`) %>% 
  pivot_wider(names_from = MEASURE, values_from = debt_gdp) %>% 
  select(-INDICATOR)
df_debt_wide
```
Merging dataframes (long term interest rates, debt-to-gdp ratio and gdp)
```{r}
df_merged <- df_gdp_wide %>% 
  left_join(df_ltint_wide %>% select(LOCATION, TIME, LTINT), by = c("LOCATION","TIME")) %>% 
  left_join(df_debt_wide %>% select(LOCATION, TIME, PC_GDP), by = c("LOCATION","TIME")) %>% 
  rename(debt_gdp = PC_GDP)
df_merged
```

Creating dataset from 2006 (date where long term interest rates data starts)
```{r}
df_merged_2006_2020 <- df_merged %>% filter(TIME>=2006)
df_merged_2006_2020 %>% write_csv("gdp_ltint_debt2006_2020.csv")
```

Comparing what countries are in each dataframe
```{r}
countries_gdp <- df_gdp %>% select(LOCATION) %>% unique()
countries_debt <- df_debt_ratio %>% select(LOCATION) %>% unique()
countries_ltint <- df_ltint %>% select(LOCATION) %>% unique()

setdiff(countries_gdp, countries_debt)
setdiff(countries_debt, countries_ltint)
setdiff(countries_gdp, countries_ltint)

```

```{r}
df_merged_2006_2020 %>% summary(debt_gdp)
median_debt <- median(df_merged_2006_2020$debt_gdp, na.rm=T)
```
## Data exploring

Visualising the relationship between GDP and long term interest rates in 2019 (debt-to-gdp ratio data for 2020 is very patchy)
Colour of the dot corresponds to whether the country is above or below the median debt-to-gdp ratio in 2019
```{r}
median_debt_2019 <- df_merged_2006_2020 %>% 
  filter(TIME==2019, LOCATION!="EU27_2020", LOCATION!="OECDE", LOCATION!="EA19") %>% 
  pull(debt_gdp) %>% median(na.rm=T)


```    

Scatterplot 
```{r}
p1 <- df_merged_2006_2020 %>% 
    filter(TIME==2019, LOCATION!="EU27_2020", LOCATION!="OECDE", LOCATION!="EA19") %>% 
    mutate(above_debt_median=if_else(debt_gdp>=median_debt_2019,TRUE,FALSE)) %>% 
    ggplot(aes(LTINT, GDP_MLN_USD, colour=above_debt_median, group=LOCATION)) + 
    geom_point()
ggplotly(p1) 
```    

Visualising the relationship between GDP and long term interest rates in 2013
Colour of the dot corresponds to whether the country is above or below the median debt-to-gdp ratio in 2013
```{r}
median_debt_2013 <- df_merged_2006_2020 %>% 
  filter(TIME==2013, LOCATION!="EU27_2020", LOCATION!="OECDE", LOCATION!="EA19") %>% 
  pull(debt_gdp) %>% median(na.rm=T)


```    

Scatterplot
```{r}
p2 <- df_merged_2006_2020 %>% 
    filter(TIME==2013, LOCATION!="EU27_2020", LOCATION!="OECDE", LOCATION!="EA19") %>% 
    mutate(above_debt_median=if_else(debt_gdp>=median_debt_2013,TRUE,FALSE)) %>% 
    ggplot(aes(LTINT, GDP_MLN_USD, colour=above_debt_median, group=LOCATION)) + 
    geom_point()
ggplotly(p2) 
```    

Creating a eurozone countries variable
```{r}
eurozone <- c("AUT","BEL","CYP","EST","FIN","FRA","DEU","GRC","IRL","ITA","LVA","LTU","LUX","MLT","NLD","PRT","SVK","SVN","ESP")

median_debt_euro_2019 <- df_merged_2006_2020 %>% 
  filter(TIME==2013, LOCATION %in% eurozone) %>% 
  pull(debt_gdp) %>% median(na.rm=T)

```  

Visualising long term interest rates and GDP relationship, colour-coded by above or below median of eurozone debt-to-gdp ratio
```{r}
p3 <- df_merged_2006_2020 %>% 
    filter(TIME==2019, LOCATION %in% eurozone) %>% 
    mutate(above_debt_median=if_else(debt_gdp>=median_debt_euro_2019,TRUE,FALSE)) %>% 
    ggplot(aes(LTINT, GDP_MLN_USD, colour=above_debt_median, group=LOCATION)) + 
    geom_point()
ggplotly(p3) 
```    

Visualising long term interest rates and debt-to-gdp ratio relationship in eurozone
```{r}
p4 <- df_merged_2006_2020 %>% 
    filter(TIME==2019, LOCATION %in% eurozone) %>% 
    ggplot(aes(LTINT, debt_gdp, colour=LOCATION)) + 
    geom_point()
ggplotly(p4) 
```    
